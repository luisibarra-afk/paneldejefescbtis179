<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eventos â€” CBTis 179</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#F0EDE7; --surface:#FAF8F5; --card:#FFFFFF;
  --border:#E0DBD3; --border2:#CEC9C0;
  --text:#1A1714; --muted:#8C8479; --lite:#C0BAB0;
  --guinda:#6B2D52; --guinda-d:#4A1E39; --oro:#B8872A;
  --teal:#0D7C66; --teal-d:#0A5C4A; --teal-l:#E8F8F5;
  --green:#166534; --green-l:#DCFCE7;
  --yellow:#854D0E; --yellow-l:#FEF9C3;
  --red:#991B1B; --red-l:#FEE2E2;
  --blue:#1A4F7A; --blue-l:#EAF2FA;
  --mora:#7D3C98; --mora-l:#F5EEF8;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}

/* HEADER */
.site-header{background:var(--guinda-d);position:relative;overflow:hidden;}
.site-header::before{content:'';position:absolute;inset:0;background:repeating-linear-gradient(45deg,transparent,transparent 24px,rgba(255,255,255,.025) 24px,rgba(255,255,255,.025) 25px);}
.header-inner{position:relative;z-index:1;padding:20px 32px;display:flex;align-items:center;gap:16px;}
.header-icon{width:44px;height:44px;border-radius:12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.header-text h1{font-family:'Playfair Display',serif;font-size:20px;color:#fff;line-height:1.2;}
.header-text p{font-size:11px;color:rgba(255,255,255,.5);margin-top:2px;font-weight:300;}
.header-back{margin-left:auto;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;color:#fff;text-decoration:none;transition:background .15s;}
.header-back:hover{background:rgba(255,255,255,.2);}

/* NAV */
.site-nav{background:var(--guinda-d);border-bottom:2px solid var(--oro);display:flex;padding:0 32px;overflow-x:auto;}
.site-nav a{padding:10px 18px;font-size:10px;font-weight:600;color:rgba(255,255,255,.45);text-decoration:none;text-transform:uppercase;letter-spacing:.08em;border-bottom:2px solid transparent;margin-bottom:-2px;transition:color .15s,border-color .15s;white-space:nowrap;}
.site-nav a:hover{color:rgba(255,255,255,.8);}
.site-nav a.active{color:#fff;border-bottom-color:var(--oro);}

/* STATS BAR */
.stats-bar{display:grid;grid-template-columns:repeat(4,1fr);background:var(--surface);border-bottom:1px solid var(--border);}
.stat-cell{padding:12px 20px;border-right:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.stat-cell:last-child{border-right:none;}
.stat-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0;}
.stat-num{font-family:'Playfair Display',serif;font-size:20px;line-height:1;}
.stat-lbl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.07em;margin-top:1px;}

/* SYNC BAR */
.sync-bar{background:var(--surface);border-bottom:1px solid var(--border);padding:6px 32px;display:flex;align-items:center;gap:8px;font-size:11px;color:var(--muted);}
.sync-dot{width:8px;height:8px;border-radius:50%;background:var(--lite);flex-shrink:0;transition:background .3s;}
.sync-dot.ok{background:var(--green);}
.sync-dot.saving{background:var(--oro);animation:pulse .8s infinite;}
.sync-dot.error{background:#991B1B;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* MAIN */
.main{padding:28px 32px;max-width:1100px;margin:0 auto;}
.page-title{font-family:'Playfair Display',serif;font-size:24px;color:var(--guinda);margin-bottom:4px;}
.page-sub{font-size:12px;color:var(--muted);margin-bottom:24px;font-weight:300;}

/* TOP BAR */
.top-bar{display:flex;align-items:center;gap:12px;margin-bottom:24px;flex-wrap:wrap;}
.btn-nueva{background:var(--teal);color:#fff;border:none;border-radius:10px;padding:10px 22px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;transition:opacity .15s;}
.btn-nueva:hover{opacity:.87;}
.search-wrap{position:relative;flex:1;min-width:200px;max-width:340px;}
.search-wrap input{width:100%;border:1px solid var(--border);border-radius:10px;padding:8px 12px 8px 36px;font-family:'Outfit',sans-serif;font-size:13px;background:var(--surface);outline:none;color:var(--text);transition:border-color .15s;}
.search-wrap input:focus{border-color:var(--teal);}
.search-wrap::before{content:'ğŸ”';position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:13px;pointer-events:none;}
.filter-wrap{display:flex;gap:6px;flex-wrap:wrap;margin-left:auto;}
.filter-btn{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:600;color:var(--muted);cursor:pointer;font-family:'Outfit',sans-serif;transition:all .15s;}
.filter-btn:hover,.filter-btn.on{background:var(--teal);color:#fff;border-color:var(--teal);}

/* EVENT LIST */
.ev-list{display:flex;flex-direction:column;gap:12px;}
.empty-state{text-align:center;padding:48px 24px;color:var(--muted);}
.empty-state .ei{font-size:40px;margin-bottom:12px;}
.empty-state p{font-size:13px;}

/* EVENT CARD */
.ev-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.04);transition:box-shadow .2s;}
.ev-card:hover{box-shadow:0 4px 20px rgba(0,0,0,.08);}
.ev-strip{height:4px;}
.ev-top{display:flex;align-items:flex-start;gap:14px;padding:16px 20px 12px;}
.ev-tipo-badge{flex-shrink:0;border-radius:10px;padding:7px 10px;display:flex;flex-direction:column;align-items:center;gap:3px;min-width:56px;text-align:center;}
.ev-emoji{font-size:20px;line-height:1;}
.ev-tipo-lbl{font-size:9px;font-weight:700;letter-spacing:.03em;line-height:1;}
.ev-info{flex:1;min-width:0;}
.ev-nombre{font-size:15px;font-weight:700;line-height:1.3;margin-bottom:5px;}
.ev-meta-row{display:flex;flex-wrap:wrap;gap:5px;align-items:center;margin-bottom:8px;}
.emeta{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--muted);background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:2px 9px;}
.emeta strong{color:var(--text);font-weight:600;}
.ev-snippet{font-size:12px;color:var(--muted);line-height:1.5;margin-bottom:3px;}
.ev-snippet strong{color:var(--text);font-weight:600;}
.ev-actions{display:flex;flex-direction:column;align-items:flex-end;gap:7px;flex-shrink:0;}
.ev-photo-btn{border-radius:8px;padding:6px 12px;font-size:11px;font-weight:700;letter-spacing:.03em;border:1.5px dashed var(--border);cursor:pointer;font-family:'Outfit',sans-serif;transition:all .15s;white-space:nowrap;outline:none;display:flex;align-items:center;gap:5px;background:#fff;color:var(--muted);}
.ev-photo-btn:hover{border-color:var(--teal);color:var(--teal);background:var(--teal-l);}
.ev-photo-btn.has-photos{background:var(--green-l);color:var(--green);border:1.5px solid #86EFAC;}
.ev-photo-btn.has-photos:hover{background:#D1FAE5;}
.ev-btns-row{display:flex;gap:6px;}
.btn-edit{background:none;border:1px solid var(--border);border-radius:6px;padding:3px 10px;font-size:10px;color:var(--muted);cursor:pointer;font-family:'Outfit',sans-serif;transition:all .15s;}
.btn-edit:hover{border-color:var(--teal);color:var(--teal);}
.btn-del{background:none;border:1px solid #FECACA;border-radius:6px;padding:3px 10px;font-size:10px;color:var(--red);cursor:pointer;font-family:'Outfit',sans-serif;}
.btn-del:hover{background:var(--red-l);}

/* MODAL BASE */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:900;display:flex;align-items:center;justify-content:center;padding:16px;opacity:0;pointer-events:none;transition:opacity .2s;}
.modal-overlay.open{opacity:1;pointer-events:all;}
.modal-box{background:#fff;border-radius:20px;width:100%;max-width:580px;max-height:90vh;overflow-y:auto;box-shadow:0 24px 64px rgba(0,0,0,.25);transform:translateY(16px);transition:transform .2s;}
.modal-overlay.open .modal-box{transform:none;}
.modal-header{padding:22px 24px 0;display:flex;align-items:center;justify-content:space-between;}
.modal-header h2{font-family:'Playfair Display',serif;font-size:18px;color:var(--guinda);}
.modal-close{background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted);line-height:1;padding:4px;}
.modal-close:hover{color:var(--text);}
.modal-body{padding:20px 24px 28px;}

/* FORM */
.form-row{margin-bottom:14px;}
.form-row label{display:block;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:5px;}
.form-row input,.form-row textarea,.form-row select{width:100%;border:1px solid var(--border);border-radius:9px;padding:10px 12px;font-family:'Outfit',sans-serif;font-size:13px;color:var(--text);background:var(--bg);outline:none;transition:border-color .15s;}
.form-row input:focus,.form-row textarea:focus,.form-row select:focus{border-color:var(--teal);}
.form-row textarea{resize:vertical;min-height:64px;line-height:1.5;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.form-hint{font-size:10px;color:var(--lite);margin-top:4px;}
.modal-footer{display:flex;gap:10px;justify-content:flex-end;border-top:1px solid var(--border);padding-top:16px;margin-top:4px;}
.btn-cancel{background:var(--bg);border:1px solid var(--border);border-radius:9px;padding:9px 20px;font-family:'Outfit',sans-serif;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);}
.btn-cancel:hover{background:var(--border);}
.btn-submit{background:var(--teal);color:#fff;border:none;border-radius:9px;padding:9px 24px;font-family:'Outfit',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:opacity .15s;}
.btn-submit:hover{opacity:.87;}
.btn-delete-confirm{background:var(--red);color:#fff;border:none;border-radius:9px;padding:9px 24px;font-family:'Outfit',sans-serif;font-size:12px;font-weight:700;cursor:pointer;}
.btn-delete-confirm:hover{opacity:.85;}

/* PHOTO MODAL */
.photo-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px;}
.photo-overlay.hidden{display:none;}
.photo-modal{background:#fff;border-radius:16px;width:100%;max-width:520px;box-shadow:0 20px 60px rgba(0,0,0,.25);overflow:hidden;}
.photo-modal-hdr{background:var(--teal);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;}
.photo-modal-hdr h3{color:#fff;font-family:'Playfair Display',serif;font-size:16px;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.photo-modal-close{background:rgba(255,255,255,.15);border:none;color:#fff;border-radius:8px;width:30px;height:30px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-left:10px;}
.photo-modal-close:hover{background:rgba(255,255,255,.25);}
.photo-modal-body{padding:20px;}
.photo-subtitle{font-size:11px;color:var(--muted);font-weight:500;margin-bottom:12px;padding:8px 12px;background:var(--bg);border-radius:8px;border-left:3px solid var(--teal);line-height:1.4;}
.photo-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.photo-col{display:flex;flex-direction:column;gap:6px;}
.photo-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);text-align:center;}
.photo-slot{border-radius:12px;overflow:hidden;position:relative;aspect-ratio:4/3;border:2px dashed var(--border);background:var(--bg);cursor:pointer;transition:border-color .15s,background .15s;}
.photo-slot:hover{border-color:var(--teal);background:var(--teal-l);}
.photo-slot.uploaded{border:2px solid #86EFAC;cursor:default;}
.photo-slot input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;z-index:2;}
.photo-slot.uploaded input[type=file]{display:none;}
.photo-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:6px;padding:12px;}
.photo-empty-ico{font-size:26px;}
.photo-empty-txt{font-size:10px;color:var(--muted);text-align:center;line-height:1.4;}
.photo-img{width:100%;height:100%;object-fit:cover;display:block;}
.photo-overlay-btns{position:absolute;inset:0;background:rgba(0,0,0,.6);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;opacity:0;transition:opacity .2s;z-index:3;}
.photo-slot.uploaded:hover .photo-overlay-btns{opacity:1;}
.photo-overlay-btns button{background:rgba(255,255,255,.92);border:none;border-radius:8px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Outfit',sans-serif;width:126px;}
.photo-overlay-btns button:hover{background:#fff;}
.photo-meta{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.6);color:#fff;font-size:9px;padding:4px 8px;text-align:center;z-index:1;}
.photo-uploading{position:absolute;inset:0;background:rgba(255,255,255,.88);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;z-index:5;}
.photo-spinner{width:24px;height:24px;border:3px solid var(--border);border-top-color:var(--teal);border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.photo-uploading-txt{font-size:11px;font-weight:600;color:var(--teal);}
.photo-modal-ftr{padding:14px 20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;background:var(--surface);}
.photo-cancel-btn{background:var(--bg);color:var(--muted);border:1px solid var(--border);border-radius:8px;padding:9px 24px;font-size:12px;font-weight:600;cursor:pointer;font-family:'Outfit',sans-serif;}
.photo-cancel-btn:hover{background:#EAE7E0;}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;padding:10px 18px;border-radius:10px;font-size:12px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,.15);opacity:0;transform:translateY(8px);transition:all .25s;pointer-events:none;z-index:9999;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.ok{background:var(--green);color:#fff;}
.toast.info{background:var(--teal);color:#fff;}
.toast.err{background:var(--red);color:#fff;}

/* FOOTER */
.site-footer{margin-top:48px;background:var(--guinda-d);padding:16px 32px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;}
.site-footer span{font-size:10px;color:rgba(255,255,255,.35);}
.site-footer strong{color:rgba(255,255,255,.6);}

@media(max-width:650px){
  .main{padding:16px;}
  .header-inner{padding:14px 16px;}
  .stats-bar{grid-template-columns:repeat(2,1fr);}
  .form-grid{grid-template-columns:1fr;}
  .top-bar{gap:8px;}
  .filter-wrap{margin-left:0;}
  .ev-top{flex-wrap:wrap;}
  .ev-actions{flex-direction:row;flex-wrap:wrap;width:100%;}
}
</style>
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <div class="header-icon">ğŸ‰</div>
    <div class="header-text">
      <h1>Eventos Institucionales</h1>
      <p>CBTis 179 Â· CÃ­vicos Â· Deportivos Â· Culturales Â· Reuniones Â· Ciclo Escolar 2025â€“2026</p>
    </div>
    <a href="index.html" class="header-back">â† Inicio</a>
  </div>
</header>

<nav class="site-nav">
  <a href="index.html">Inicio</a>
  <a href="gantt_sems.html">Programas Institucionales</a>
  <a href="supervision.html">SupervisiÃ³n</a>
  <a href="circulares.html">Circulares</a>
  <a href="eventos.html" class="active">Eventos</a>
</nav>

<div class="stats-bar">
  <div class="stat-cell"><div class="stat-dot" style="background:var(--teal)"></div><div><div class="stat-num" id="st-total">0</div><div class="stat-lbl">Total</div></div></div>
  <div class="stat-cell"><div class="stat-dot" style="background:#6B2D52"></div><div><div class="stat-num" id="st-civico">0</div><div class="stat-lbl">CÃ­vicos</div></div></div>
  <div class="stat-cell"><div class="stat-dot" style="background:#166534"></div><div><div class="stat-num" id="st-dep">0</div><div class="stat-lbl">Deportivos</div></div></div>
  <div class="stat-cell"><div class="stat-dot" style="background:#854D0E"></div><div><div class="stat-num" id="st-reuniones">0</div><div class="stat-lbl">Reuniones</div></div></div>
</div>

<div class="sync-bar">
  <div class="sync-dot" id="syncDot"></div>
  <span id="syncMsg">Conectando con Google Sheetsâ€¦</span>
  <button onclick="loadFromSheets()" style="margin-left:auto;background:none;border:1px solid var(--border);border-radius:6px;padding:3px 12px;font-size:10px;font-weight:600;color:var(--muted);cursor:pointer;font-family:'Outfit',sans-serif">ğŸ”„ Actualizar</button>
</div>

<div class="main">
  <div class="page-title">Registro de Eventos</div>
  <div class="page-sub">Registra eventos cÃ­vicos, deportivos, culturales e institucionales Â· Agrega hasta 2 fotos por evento Â· Documenta quiÃ©n estuvo presente y quÃ© se realizÃ³</div>

  <div class="top-bar">
    <button class="btn-nueva" onclick="openModal()">ï¼‹ Nuevo evento</button>
    <div class="search-wrap">
      <input type="text" id="searchInput" placeholder="Buscar por nombre, tipo, actividadesâ€¦" oninput="renderList()">
    </div>
    <div class="filter-wrap">
      <button class="filter-btn on" onclick="setFilter('todos',this)">Todos</button>
      <button class="filter-btn" onclick="setFilter('CÃ­vico',this)">ğŸŒ CÃ­vico</button>
      <button class="filter-btn" onclick="setFilter('Deportivo',this)">âš½ Deportivo</button>
      <button class="filter-btn" onclick="setFilter('Cultural',this)">ğŸ­ Cultural</button>
      <button class="filter-btn" onclick="setFilter('Institucional',this)">ğŸ« Institucional</button>
      <button class="filter-btn" onclick="setFilter('ReuniÃ³n de padres',this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Padres</button>
    </div>
  </div>

  <div class="ev-list" id="evList"></div>
</div>

<footer class="site-footer">
  <span>CBTis 179 Â· Eventos Â· Ciclo Escolar <strong>2025â€“2026</strong></span>
  <span>SEP Â· DGETI Â· SEMS Â· Hidalgo</span>
</footer>

<div class="toast" id="toast"></div>

<!-- â•â• MODAL NUEVO/EDITAR EVENTO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalOverlay" onclick="closeOnBg(event)">
  <div class="modal-box">
    <div class="modal-header">
      <h2 id="modalTitle">Nuevo Evento</h2>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-row">
          <label>Tipo de evento</label>
          <select id="f-tipo">
            <option value="">â€” Seleccionar â€”</option>
            <option>CÃ­vico</option>
            <option>Deportivo</option>
            <option>Cultural</option>
            <option>Institucional</option>
            <option>ReuniÃ³n de padres</option>
            <option>ReuniÃ³n de docentes</option>
            <option>AcadÃ©mico</option>
            <option>Ambiental</option>
            <option>Otro</option>
          </select>
        </div>
        <div class="form-row">
          <label>Fecha del evento</label>
          <input type="date" id="f-fecha">
        </div>
      </div>

      <div class="form-row">
        <label>Nombre / Subcarpeta en Drive</label>
        <input type="text" id="f-nombre" placeholder="Ej: Homenaje lunes 23, ReuniÃ³n de padres primer parcial">
        <div class="form-hint">Este nombre se usa como subcarpeta en Google Drive para organizar las fotos</div>
      </div>

      <div class="form-row">
        <label>Â¿QuiÃ©n estuvo presente?</label>
        <textarea id="f-presentes" placeholder="Ej: Alumnos de 1Â°A y 2Â°B, directivos, profesores del Ã¡rea, padres de familiaâ€¦"></textarea>
      </div>

      <div class="form-row">
        <label>Â¿QuÃ© se hizo? (Actividades realizadas)</label>
        <textarea id="f-actividades" placeholder="Ej: Se realizÃ³ homenaje cÃ­vico con participaciÃ³n del grupo de danza, presentaciÃ³n del himno nacionalâ€¦"></textarea>
      </div>

      <div class="form-row">
        <label>Autoridades / Personalidades presentes (opcional)</label>
        <textarea id="f-autoridades" placeholder="Ej: Director regional DGETI, Presidenta municipal de Tulancingoâ€¦" style="min-height:52px"></textarea>
      </div>

      <div class="form-row">
        <label>Notas adicionales (opcional)</label>
        <textarea id="f-notas" placeholder="Cualquier informaciÃ³n relevante adicionalâ€¦" style="min-height:52px"></textarea>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
        <button class="btn-submit" onclick="guardarEvento()">ğŸ’¾ Guardar evento</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â• MODAL CONFIRMAR ELIMINAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="confirmOverlay" onclick="if(event.target===this)closeConfirm()">
  <div class="modal-box" style="max-width:380px">
    <div class="modal-header" style="justify-content:center;padding-bottom:4px;">
      <h2 style="color:var(--red)">Eliminar evento</h2>
    </div>
    <div class="modal-body" style="text-align:center;">
      <div style="font-size:36px;margin-bottom:10px;">ğŸ—‘ï¸</div>
      <div style="font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:6px;">Â¿EstÃ¡s seguro de que quieres eliminar este evento?</div>
      <div id="confirmName" style="font-size:14px;font-weight:700;color:var(--text);margin-bottom:6px;"></div>
      <p style="font-size:11px;color:var(--red);margin-bottom:20px;font-weight:600;">Se eliminarÃ¡n tambiÃ©n las fotos almacenadas en Drive.</p>
      <div class="modal-footer" style="justify-content:center;">
        <button class="btn-cancel" onclick="closeConfirm()">Cancelar</button>
        <button class="btn-delete-confirm" onclick="confirmDelete()">ğŸ—‘ï¸ SÃ­, eliminar</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â• MODAL FOTOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="photo-overlay hidden" id="photoOverlay" onclick="photoOverlayClick(event)">
  <div class="photo-modal">
    <div class="photo-modal-hdr">
      <h3 id="photoModalTitle">ğŸ“· Fotos del evento</h3>
      <button class="photo-modal-close" onclick="closePhotoModal()">âœ•</button>
    </div>
    <div class="photo-modal-body" id="photoModalBody"></div>
    <div class="photo-modal-ftr">
      <button class="photo-cancel-btn" onclick="closePhotoModal()">Cerrar</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let EVENTOS = [];
let EV_PHOTOS = {}; // { [eventoId]: { photos: [null|photoObj, null|photoObj] } }
let currentFilter = 'todos';
let editingId = null;
let _photoCurrent = null; // { eventoId }

// â•â• CONFIGURACIÃ“N â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API_URL = 'https://script.google.com/macros/s/AKfycbwh9bXtyY988hcTqw8SRFpHXgnek0yvznxZ0WD0M3DaWRkTGI2hafkk-7E17UHsCFo/exec';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,6); }

// â”€â”€â”€ TIPO CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TIPO_CFG = {
  'CÃ­vico':              { emoji:'ğŸŒ', color:'#6B2D52', bg:'#F5EEF4', strip:'#D4A0C5' },
  'Deportivo':           { emoji:'âš½', color:'#166534', bg:'#DCFCE7', strip:'#86EFAC' },
  'Cultural':            { emoji:'ğŸ­', color:'#7D3C98', bg:'#F5EEF8', strip:'#C39BD3' },
  'Institucional':       { emoji:'ğŸ«', color:'#1A4F7A', bg:'#EAF2FA', strip:'#7FB3D3' },
  'ReuniÃ³n de padres':   { emoji:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', color:'#854D0E', bg:'#FEF9C3', strip:'#F9E79F' },
  'ReuniÃ³n de docentes': { emoji:'ğŸ¤', color:'#0E7490', bg:'#ECFEFF', strip:'#67E8F9' },
  'AcadÃ©mico':           { emoji:'ğŸ“', color:'#1E3A5F', bg:'#EBF5FB', strip:'#AED6F1' },
  'Ambiental':           { emoji:'ğŸŒ³', color:'#196F3D', bg:'#E9F7EF', strip:'#82E0AA' },
  'Otro':                { emoji:'ğŸ“Œ', color:'#8C8479', bg:'#F0EDE7', strip:'#C8BEB5' },
};
function getTipo(tipo){ return TIPO_CFG[tipo] || TIPO_CFG['Otro']; }

// â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setSyncStatus(state, msg){
  const dot=document.getElementById('syncDot');
  const txt=document.getElementById('syncMsg');
  if(dot) dot.className='sync-dot '+state;
  if(txt) txt.textContent=msg;
}
async function apiGet(params){
  const res=await fetch(API_URL+'?'+new URLSearchParams(params));
  return res.json();
}
async function apiPost(body){
  const res=await fetch(API_URL,{method:'POST',body:JSON.stringify(body)});
  return res.json();
}

// â”€â”€â”€ LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadFromSheets(){
  setSyncStatus('saving','Cargando desde Google Sheetsâ€¦');
  document.getElementById('evList').innerHTML='<div class="empty-state"><p>Cargandoâ€¦</p></div>';
  try{
    const [evData, phData] = await Promise.all([
      apiGet({action:'ev_getAll'}),
      apiGet({action:'ev_getPhotos'})
    ]);
    if(evData.error) throw new Error(evData.error);
    EVENTOS = (evData.rows||[]);
    EV_PHOTOS = {};
    (phData.rows||[]).forEach(r=>{
      const slot=parseInt(r.slot)||0;
      if(!EV_PHOTOS[r.evento_id]) EV_PHOTOS[r.evento_id]={photos:[null,null]};
      EV_PHOTOS[r.evento_id].photos[slot]={
        fileId:r.fileId, driveUrl:r.fileUrl,
        fileName:r.fileName, uploadedAt:r.uploadedAt
      };
    });
    setSyncStatus('ok','Sincronizado âœ“');
  }catch(e){
    setSyncStatus('error','Error: '+e.message);
  }
  renderList();
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderList(){
  const q=document.getElementById('searchInput').value.toLowerCase().trim();
  const list=document.getElementById('evList');
  let items=EVENTOS.slice().reverse();
  if(currentFilter!=='todos') items=items.filter(e=>e.tipo===currentFilter);
  if(q) items=items.filter(e=>
    (e.nombre||'').toLowerCase().includes(q)||
    (e.tipo||'').toLowerCase().includes(q)||
    (e.presentes||'').toLowerCase().includes(q)||
    (e.actividades||'').toLowerCase().includes(q)||
    (e.autoridades||'').toLowerCase().includes(q)
  );
  updateStats();
  if(!items.length){
    list.innerHTML=`<div class="empty-state"><div class="ei">ğŸ‰</div><p>${EVENTOS.length?'Sin resultados para tu bÃºsqueda.':'AÃºn no hay eventos registrados.<br>Presiona <strong>ï¼‹ Nuevo evento</strong> para comenzar.'}</p></div>`;
    return;
  }
  list.innerHTML=items.map(e=>cardHTML(e)).join('');
}

function cardHTML(ev){
  const t=getTipo(ev.tipo);
  const ph=EV_PHOTOS[ev.id];
  const cnt=ph?(ph.photos||[]).filter(p=>p&&p.fileId).length:0;
  const photoCls=cnt>0?'ev-photo-btn has-photos':'ev-photo-btn';
  const photoLbl=cnt>0?`ğŸ“· ${cnt}/2 fotos`:'ğŸ“· Agregar fotos';
  const fechaFmt=ev.fecha?fmtDate(ev.fecha):'';
  return `<div class="ev-card" id="evc-${ev.id}">
    <div class="ev-strip" style="background:${t.strip}"></div>
    <div class="ev-top">
      <div class="ev-tipo-badge" style="background:${t.bg};color:${t.color}">
        <span class="ev-emoji">${t.emoji}</span>
        <span class="ev-tipo-lbl">${ev.tipo||'Evento'}</span>
      </div>
      <div class="ev-info">
        <div class="ev-nombre">${ev.nombre||'Sin nombre'}</div>
        <div class="ev-meta-row">
          ${fechaFmt?`<div class="emeta">ğŸ“… <strong>${fechaFmt}</strong></div>`:''}
          ${ev.autoridades?`<div class="emeta">ğŸ›ï¸ <strong>Autoridades presentes</strong></div>`:''}
          ${cnt>0?`<div class="emeta">ğŸ“· <strong>${cnt} foto${cnt>1?'s':''}</strong></div>`:''}
        </div>
        ${ev.presentes?`<div class="ev-snippet"><strong>Presentes:</strong> ${truncate(ev.presentes,100)}</div>`:''}
        ${ev.actividades?`<div class="ev-snippet"><strong>Actividades:</strong> ${truncate(ev.actividades,100)}</div>`:''}
      </div>
      <div class="ev-actions">
        <button class="${photoCls}" onclick="openPhotoModal('${ev.id}')">${photoLbl}</button>
        <div class="ev-btns-row">
          <button class="btn-edit" onclick="openEdit('${ev.id}')">âœï¸ Editar</button>
          <button class="btn-del" onclick="deleteEvento('${ev.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>
  </div>`;
}

function truncate(s,n){ return s&&s.length>n?s.slice(0,n)+'â€¦':s; }

function updateStats(){
  document.getElementById('st-total').textContent=EVENTOS.length;
  document.getElementById('st-civico').textContent=EVENTOS.filter(e=>e.tipo==='CÃ­vico').length;
  document.getElementById('st-dep').textContent=EVENTOS.filter(e=>e.tipo==='Deportivo').length;
  document.getElementById('st-reuniones').textContent=EVENTOS.filter(e=>e.tipo==='ReuniÃ³n de padres'||e.tipo==='ReuniÃ³n de docentes').length;
}

function setFilter(f,btn){
  currentFilter=f;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  renderList();
}

// â”€â”€â”€ MODAL NEW/EDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(){
  editingId=null;
  document.getElementById('modalTitle').textContent='Nuevo Evento';
  clearForm();
  document.getElementById('f-fecha').value=todayStr();
  document.getElementById('modalOverlay').classList.add('open');
}
function openEdit(id){
  const ev=EVENTOS.find(x=>x.id===id); if(!ev) return;
  editingId=id;
  document.getElementById('modalTitle').textContent='Editar Evento';
  document.getElementById('f-tipo').value=ev.tipo||'';
  document.getElementById('f-nombre').value=ev.nombre||'';
  document.getElementById('f-fecha').value=ev.fecha||'';
  document.getElementById('f-presentes').value=ev.presentes||'';
  document.getElementById('f-actividades').value=ev.actividades||'';
  document.getElementById('f-autoridades').value=ev.autoridades||'';
  document.getElementById('f-notas').value=ev.notas||'';
  document.getElementById('modalOverlay').classList.add('open');
}
function closeModal(){ document.getElementById('modalOverlay').classList.remove('open'); }
function closeOnBg(e){ if(e.target===document.getElementById('modalOverlay')) closeModal(); }
function clearForm(){
  ['f-tipo','f-nombre','f-fecha','f-presentes','f-actividades','f-autoridades','f-notas'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.value='';
  });
}

async function guardarEvento(){
  const tipo=document.getElementById('f-tipo').value;
  const nombre=document.getElementById('f-nombre').value.trim();
  if(!tipo){ showToast('âš  Selecciona el tipo de evento','err'); return; }
  if(!nombre){ showToast('âš  El nombre / subcarpeta es obligatorio','err'); return; }
  const evento={
    id: editingId||uid(),
    tipo, nombre,
    fecha:   document.getElementById('f-fecha').value,
    presentes:   document.getElementById('f-presentes').value.trim(),
    actividades: document.getElementById('f-actividades').value.trim(),
    autoridades: document.getElementById('f-autoridades').value.trim(),
    notas:       document.getElementById('f-notas').value.trim()
  };
  if(editingId){
    const idx=EVENTOS.findIndex(x=>x.id===editingId);
    if(idx>-1) EVENTOS[idx]={...EVENTOS[idx],...evento};
  } else {
    EVENTOS.push(evento);
  }
  closeModal(); renderList();
  setSyncStatus('saving','Guardando en Sheetsâ€¦');
  try{
    await apiPost({action:'ev_save', evento});
    setSyncStatus('ok','Guardado âœ“');
    showToast(editingId?'Evento actualizado':'Evento guardado âœ“','ok');
  }catch(e){
    setSyncStatus('error',e.message);
    showToast('âš  Error al guardar: '+e.message,'err');
  }
  editingId=null;
}

// â”€â”€â”€ DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function deleteEvento(id){
  const ev=EVENTOS.find(x=>x.id===id); if(!ev) return;
  document.getElementById('confirmName').textContent=`${ev.tipo} Â· ${ev.nombre}`;
  document.getElementById('confirmOverlay').classList.add('open');
  document.getElementById('confirmOverlay').dataset.deleteId=id;
}
async function confirmDelete(){
  const id=document.getElementById('confirmOverlay').dataset.deleteId;
  EVENTOS=EVENTOS.filter(x=>x.id!==id);
  delete EV_PHOTOS[id];
  renderList(); closeConfirm();
  setSyncStatus('saving','Eliminandoâ€¦');
  try{
    await apiPost({action:'ev_delete', id});
    setSyncStatus('ok','Eliminado âœ“');
    showToast('Evento eliminado','info');
  }catch(e){
    setSyncStatus('error',e.message);
  }
}
function closeConfirm(){ document.getElementById('confirmOverlay').classList.remove('open'); }

// â”€â”€â”€ PHOTO MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openPhotoModal(eventoId){
  _photoCurrent={eventoId};
  const ev=EVENTOS.find(x=>x.id===eventoId);
  document.getElementById('photoModalTitle').textContent=`ğŸ“· ${ev?ev.nombre:'Fotos'}`;
  refreshPhotoModal();
  document.getElementById('photoOverlay').classList.remove('hidden');
}
function closePhotoModal(){
  document.getElementById('photoOverlay').classList.add('hidden');
  _photoCurrent=null;
}
function photoOverlayClick(e){
  if(e.target===document.getElementById('photoOverlay')) closePhotoModal();
}
function refreshPhotoModal(){
  if(!_photoCurrent) return;
  const {eventoId}=_photoCurrent;
  const ev=EVENTOS.find(x=>x.id===eventoId);
  const t=ev?getTipo(ev.tipo):getTipo('Otro');
  document.getElementById('photoModalBody').innerHTML=`
    <div class="photo-subtitle">
      ${ev?`${t.emoji} ${ev.tipo}${ev.nombre?' Â· '+ev.nombre:''}${ev.fecha?' Â· '+fmtDate(ev.fecha):''}`:''}</div>
    <p style="font-size:11px;color:var(--muted);margin-bottom:14px;display:flex;align-items:center;gap:6px;">ğŸ“ MÃ¡x 2 fotos Â· JPG Â· PNG Â· WEBP Â· mÃ¡x 5 MB</p>
    <div class="photo-row">
      ${buildSlotHtml(eventoId,0)}
      ${buildSlotHtml(eventoId,1)}
    </div>`;
}

function buildSlotHtml(eventoId, slot){
  const ph=(EV_PHOTOS[eventoId]||{photos:[null,null]});
  const photo=(ph.photos||[])[slot];
  if(photo&&photo.fileId){
    const thumb=`https://drive.google.com/thumbnail?id=${photo.fileId}&sz=w400`;
    return `<div class="photo-col">
      <div class="photo-lbl">Foto ${slot+1}</div>
      <div class="photo-slot uploaded" id="pslot-${slot}">
        <img class="photo-img" src="${thumb}" alt="Foto ${slot+1}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
        <div class="photo-empty" style="display:none"><div class="photo-empty-ico">ğŸ“·</div><div class="photo-empty-txt">Vista previa<br>no disponible</div></div>
        <div class="photo-overlay-btns">
          <button onclick="viewPhotoEv('${eventoId}',${slot})">ğŸ” Ver en Drive</button>
          <button onclick="replacePhotoEv(${slot})">ğŸ”„ Cambiar foto</button>
          <button onclick="deletePhotoEv('${eventoId}',${slot})">ğŸ—‘ Borrar foto</button>
        </div>
        <div class="photo-meta">${photo.fileName}<br>${photo.uploadedAt}</div>
        <input type="file" accept="image/jpeg,image/png,image/jpg,image/webp" id="pinput-${slot}" onchange="selectPhotoEv(${slot},event)" style="display:none">
      </div>
    </div>`;
  }
  return `<div class="photo-col">
    <div class="photo-lbl">Foto ${slot+1}</div>
    <div class="photo-slot" id="pslot-${slot}">
      <input type="file" accept="image/jpeg,image/png,image/jpg,image/webp" onchange="selectPhotoEv(${slot},event)">
      <div class="photo-empty">
        <div class="photo-empty-ico">ğŸ“·</div>
        <div class="photo-empty-txt">Clic o arrastra<br>una foto aquÃ­<br><small>JPG Â· PNG Â· WEBP Â· mÃ¡x 5 MB</small></div>
      </div>
    </div>
  </div>`;
}

function replacePhotoEv(slot){
  const input=document.getElementById('pinput-'+slot);
  if(input) input.click();
}
function viewPhotoEv(eventoId,slot){
  const ph=(EV_PHOTOS[eventoId]||{photos:[null,null]}).photos[slot];
  if(ph&&ph.driveUrl) window.open(ph.driveUrl,'_blank');
}
async function deletePhotoEv(eventoId,slot){
  if(!confirm('Â¿Eliminar esta foto? Se borrarÃ¡ de Drive.')) return;
  setSyncStatus('saving','Eliminando fotoâ€¦');
  try{
    const r=await apiPost({action:'ev_driveDelete',evento_id:eventoId,slot});
    if(r.error) throw new Error(r.error);
    if(EV_PHOTOS[eventoId]) EV_PHOTOS[eventoId].photos[slot]=null;
    setSyncStatus('ok','Foto eliminada âœ“');
    showToast('Foto '+(slot+1)+' eliminada','info');
    refreshPhotoModal();
    renderList();
  }catch(e){
    setSyncStatus('error',e.message);
    showToast('âš  Error al borrar: '+e.message,'err');
  }
}

async function selectPhotoEv(slot,event){
  const file=event.target.files[0];
  if(!file) return;
  if(file.size>5*1024*1024){ showToast('âš  La foto supera los 5 MB','err'); return; }
  const {eventoId}=_photoCurrent;
  const ev=EVENTOS.find(x=>x.id===eventoId);
  const slotEl=document.getElementById('pslot-'+slot);
  if(slotEl){
    const spinner=document.createElement('div');
    spinner.className='photo-uploading';
    spinner.innerHTML='<div class="photo-spinner"></div><div class="photo-uploading-txt">Subiendo a Driveâ€¦</div>';
    slotEl.appendChild(spinner);
  }
  const reader=new FileReader();
  reader.onload=async ev2=>{
    setSyncStatus('saving','Subiendo foto a Driveâ€¦');
    try{
      const result=await apiPost({
        action:   'ev_driveUpload',
        evento_id: eventoId,
        slot,
        tipo:     ev?ev.tipo:'Otro',
        nombre:   ev?ev.nombre:eventoId,
        fileName: file.name,
        fileData: ev2.target.result,
        mimeType: file.type
      });
      if(result.error) throw new Error(result.error);
      if(!EV_PHOTOS[eventoId]) EV_PHOTOS[eventoId]={photos:[null,null]};
      EV_PHOTOS[eventoId].photos[slot]={
        fileId:   result.fileId,
        driveUrl: result.fileUrl,
        fileName: file.name,
        uploadedAt: new Date().toLocaleDateString('es-MX',{day:'2-digit',month:'short',year:'numeric'})
      };
      setSyncStatus('ok','Foto guardada en Drive âœ“');
      showToast('Foto '+(slot+1)+' guardada en Drive','ok');
      refreshPhotoModal();
      renderList();
    }catch(e){
      setSyncStatus('error','Error: '+e.message);
      showToast('âš  Error al subir: '+e.message,'err');
      const sp=slotEl?slotEl.querySelector('.photo-uploading'):null;
      if(sp) sp.remove();
    }
  };
  reader.readAsDataURL(file);
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function todayStr(){ return new Date().toISOString().slice(0,10); }
function fmtDate(s){
  if(!s) return '';
  const [y,m,d]=s.split('-');
  const ms=['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'];
  return `${parseInt(d)} ${ms[parseInt(m)-1]} ${y}`;
}
function showToast(msg,type){
  const t=document.getElementById('toast');
  t.textContent=(type==='ok'?'âœ“ ':'â„¹ï¸ ')+msg;
  t.className='toast show '+(type||'ok');
  clearTimeout(t._t);
  t._t=setTimeout(()=>t.classList.remove('show'),2400);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadFromSheets();
</script>
</body>
</html>
